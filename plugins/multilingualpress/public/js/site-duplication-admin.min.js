!function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.r(n);var i=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.htmlElement=n}var n,t,i;return n=e,(t=[{key:"updateEstimatedTime",value:function(e){try{(function(e){var n=e.querySelector(".mlp-new-site-schedule-steps__estimated-remaining-time");if(!n)throw new Error("Parent Element for ".concat(e.id," cannot be found."));return n}(this.htmlElement)).innerText=e}catch(e){console.warn(e)}}},{key:"updateTotalAttachmentsNumber",value:function(e){try{(function(e){var n=e.querySelector(".mlp-new-site-schedule-steps__total-attachments");if(!n)throw new Error("Parent Element for ".concat(e.id," cannot be found."));return n}(this.htmlElement)).innerText=e}catch(e){console.warn(e)}}},{key:"updateContent",value:function(e){try{(function(e){var n=e.querySelector(".mlp-attachment-schedule-notice__content");if(!n)throw new Error("Parent Element for ".concat(e.id," cannot be found."));return n}(this.htmlElement)).innerHTML=e}catch(e){console.warn(e)}}},{key:"updateProgressBar",value:function(e){var n=e.stepsDone,t=void 0===n?0:n,r=e.allSteps,i=void 0===r?0:r;if(t&&i){var a=Math.floor(t/i*100);try{(function(e){var n,t=e.querySelector(".mlp-new-site-schedule-notice-progress");t&&(n=t.querySelector(".mlp-new-site-schedule-notice-progress__bar"));if(!n||void 0===n)throw new Error("Parent Element for ".concat(e.id," cannot be found."));return n})(this.htmlElement).style.setProperty("width",a+"%")}catch(e){console.warn(e)}}}},{key:"remove",value:function(){this.htmlElement.remove()}},{key:"updateNoticeType",value:function(e){this.htmlElement.classList.remove("notice-info","notice-success","notice-error","notice-warning"),this.htmlElement.classList.add("notice-".concat(e))}},{key:"setStyleProperty",value:function(e,n){this.htmlElement.style.setProperty(e,n)}}])&&r(n.prototype,t),i&&r(n,i),e}();function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.dOMDocument=n}var n,t,r;return n=e,(t=[{key:"dispatch",value:function(e){for(var n,t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];(n=this.dOMDocument).trigger.apply(n,[e].concat(r))}}])&&a(n.prototype,t),r&&a(n,r),e}();function s(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(n,t,r,i){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.jQuery=n,this.eventDispatcher=t,this.scheduleNoticeHtmlElement=r,this.scheduleStatusStorage=i}var n,t,r;return n=e,(t=[{key:"remove",value:function(){this.scheduleNoticeHtmlElement.remove()}},{key:"updateScheduleNoticeWithMessage",value:function(e,n){e&&(this.scheduleNoticeHtmlElement.updateContent(e),n&&this.scheduleNoticeHtmlElement.updateNoticeType(n))}},{key:"updateScheduleNoticeWithStatus",value:function(e){var n=e.schedule,t=e.estimatedRemainingTime,r=n.args.attachmentsNumber;this.scheduleNoticeHtmlElement.updateTotalAttachmentsNumber(r),this.scheduleNoticeHtmlElement.updateEstimatedTime(t),this.scheduleNoticeHtmlElement.updateProgressBar(n),this.scheduleStatusStorage.updateSetWithStatus(e),this.eventDispatcher.dispatch("multilingualpress.schedule_notice_updated",n)}},{key:"show",value:function(){this.scheduleNoticeHtmlElement.setStyleProperty("display","flex")}},{key:"hide",value:function(){this.scheduleNoticeHtmlElement.setStyleProperty("display","none")}}])&&s(n.prototype,t),r&&s(n,r),e}();var f=function e(n){var t=n.schedule,r=n.stepToFinish,i=n.estimatedRemainingTime;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.schedule=t,this.stepToFinish=r,this.estimatedRemainingTime=i};function c(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.scheduleFactory=n}var n,t,r;return n=e,(t=[{key:"create",value:function(e){var n=Object.assign({},e),t=n.schedule,r=void 0===t?{}:t;n.schedule=this.scheduleFactory.create(r);var i=new f(n);return Object.freeze(i)}}])&&c(n.prototype,t),r&&c(n,r),e}();var h={isElement:function(e){return e instanceof Element},isUndefined:function(e){return void 0!==e},isFunction:function(e){return"function"==typeof e}};function v(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(n,t,r){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.form=n,this.translations=t,this.alert=r,this.eventCallback=this.preventFormSubmission.bind(this)}var n,t,r;return n=e,(t=[{key:"blockFormSubmission",value:function(){this.form.addEventListener("submit",this.eventCallback)}},{key:"releaseFormSubmission",value:function(){this.form.removeEventListener("submit",this.eventCallback)}},{key:"preventFormSubmission",value:function(e){e.preventDefault(),e.stopImmediatePropagation(),h.isUndefined(this.translations.preventFormSubmissionMessage)||this.alert(this.translations.preventFormSubmissionMessage)}}])&&v(n.prototype,t),r&&v(n,r),e}();function p(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var b=function(){function e(n,t,r,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.requestClient=n,this.scheduleStatusResponseHandler=t,this.form=r,this.domDocument=i,this.ajaxUrl=a,this.ajaxEvent=null}var n,t,r;return n=e,(t=[{key:"update",value:function(){var e=this;this.ajaxEvent=this.requestClient({url:this.ajaxUrl,complete:function(n,t){var r=n.responseJSON.success;if(["error","abort","parsererror"].includes(t))return!1;r&&e.delayUpdate()},success:function(n){return e.scheduleStatusResponseHandler.successHandler(n)},error:function(){return e.scheduleStatusResponseHandler.errorHandler()}})}},{key:"delayUpdate",value:function(){setTimeout(this.update,1e3)}},{key:"detachAjaxEvent",value:function(){this.ajaxEvent&&this.domDocument.off("ajaxSend",this.ajaxEvent)}}])&&p(n.prototype,t),r&&p(n,r),e}();function w(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d="multilingualpress.schedule_status_update_error",m=function(){function e(n,t,r,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.scheduleNotice=n,this.eventDispatcher=t,this.scheduleStatusFactory=r,this.form=i,this.translations=a}var n,t,r;return n=e,(t=[{key:"successHandler",value:function(e){var n=e.data,t=void 0===n?{}:n,r=e.success;if(!(void 0!==r&&r))return this.scheduleNotice.remove(),void this.eventDispatcher.dispatch(d);this.scheduleNotice.show();var i=this.scheduleStatusFactory.create(t);this.scheduleNotice.updateScheduleNoticeWithStatus(i),this.eventDispatcher.dispatch("multilingualpress.schedule_status_updated",e)}},{key:"errorHandler",value:function(e,n,t){this.scheduleNotice.updateScheduleNoticeWithMessage(this.translations.scheduleInfoErrorMessage,"error"),this.eventDispatcher.dispatch(d,{message:t})}}])&&w(n.prototype,t),r&&w(n,r),e}();function g(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k="beforebegin",E=[k,"afterbegin","beforeend","afterend"],j=function(){function e(n,t,r){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),!function(e){return E.includes(e)}(n))throw new Error('Position accept only the following values: "'.concat(E,'"'));this.position=n,this.selector=t,this.template=r}var n,t,r;return n=e,(t=[{key:"replaceInto",value:function(e){h.isElement(e)&&(this.removeFrom(e),this.insertInto(e))}},{key:"insertInto",value:function(e){h.isElement(e)&&e.insertAdjacentHTML(this.position,this.template)}},{key:"removeFrom",value:function(e){if(h.isElement(e)){var n=e.querySelector(this.selector);n&&n.remove()}}}])&&g(n.prototype,t),r&&g(n,r),e}();var x=function e(n){var t=n.sourceSiteId,r=n.newSiteId,i=n.attachmentsNumber;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.sourceSiteId=t,this.newSiteId=r,this.attachmentsNumber=i};var T=function e(n){var t=n.id,r=n.stepsDone,i=n.allSteps,a=n.started,o=n.lastUpdate,s=n.args;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.stepsDone=r,this.allSteps=i,this.started=a,this.lastUpdate=o,this.args=s};function M(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,t,r;return n=e,(t=[{key:"create",value:function(e){var n=Object.assign({},e),t=n.args,r=void 0===t?{}:t;n.args=Object.freeze(new x(r));var i=new T(n);return Object.freeze(i)}}])&&M(n.prototype,t),r&&M(n,r),e}();var q=function e(n,t){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!=typeof n||!n)throw new Error("Expected nonce to be a string");if("string"!=typeof t||!t)throw new Error("Expected action to be a string");this.nonce=n,this.action=t};function P(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function W(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(n,t,r,i,a,o){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.request=n,this.ajaxUrl=t,this.nonce=r,this.action=i,this.responseHandler=a,this.spinner=o}var n,t,r;return n=e,(t=[{key:"call",value:function(e,n){var t,r=this,i=n.schedule,a=(P(t={action:this.action},this.action,"stop_attachments_copy"),P(t,this.nonce.action,this.nonce.nonce),P(t,"scheduleId",i.id),P(t,"siteId",i.args.newSiteId),t);this.request({url:this.ajaxUrl,data:a,method:"POST",beforeSend:function(){return r.spinner.replaceInto(e.parentNode)},complete:function(){return r.spinner.removeFrom(e.parentNode)},success:function(e){return r.responseHandler.success(e)},error:function(e,n,t){return r.responseHandler.error(e,n,t)}})}}])&&W(n.prototype,t),r&&W(n,r),e}();function C(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var z="multilingualpress.stop_attachment_duplication_succeed",J=function(){function e(n,t){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.scheduleNotice=n,this.eventDispatcher=t}var n,t,r;return n=e,(t=[{key:"success",value:function(e){var n=e.data.content,t=void 0===n?"":n,r=e.success,i=void 0!==r&&r;this.scheduleNotice.updateScheduleNoticeWithMessage(t,i?"success":"error"),i&&this.eventDispatcher.dispatch(z,e),!i&&this.eventDispatcher.dispatch("multilingualpress.stop_attachment_duplication_fails",e)}},{key:"error",value:function(e,n,t){this.scheduleNotice.updateScheduleNoticeWithMessage("".concat(n," : ").concat(t),"error")}}])&&C(n.prototype,t),r&&C(n,r),e}();function I(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var K=function(){function e(n,t){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.htmlElement=n,this.scheduleStatusFactory=t}var n,t,r;return n=e,(t=[{key:"updateSetWithStatus",value:function(e){this.htmlElement.dataset.currentSchedule=JSON.stringify(e)}},{key:"status",value:function(){return this.scheduleStatusFactory.create(JSON.parse(this.htmlElement.dataset.currentSchedule))}}])&&I(n.prototype,t),r&&I(n,r),e}();!function(e,n,t){if("site-new-php"===n)if(t)try{!function(){var e=document.querySelector("#mlp_new_site_schedule_tmpl");if(!e)throw new Error("Schedule Notice Template does not exists.");document.querySelector("#add-new-site").insertAdjacentHTML("afterend",e.innerHTML)}(),function(e){e.scheduleNotice.hide(),function(e){var n=e.stopAttachmentDuplicationProcessClient,t=e.domDocument,r=e.form,i=e.scheduleStatusUpdater,a=e.scheduleStatusStorage;window.addEventListener("load",function(){return i.status()},{once:!0});var o=document.querySelector("#mlp_kill_attachment_duplication");o&&o.addEventListener("click",function(e){return n.call(e.currentTarget||e.target,a.status())}),t.on(d,function(){return r.releaseFormSubmission()}),t.on(z,function(e){var n=e.success;void 0!==n&&n&&(r.releaseFormSubmission(),i.detachAjaxEvent())})}(e)}(function(){var n=t.scheduleUrl,r=t.ajaxUrl,a=void 0===r?"":r,s=e(document);if(!a)throw new TypeError("ajaxUrl must be set or schedule notice will not work");var f=function(){if(!t.hasOwnProperty("attachmentDuplicatorTranslations"))throw new Error("Translations for Site Duplication Schedule are missing");return t.attachmentDuplicatorTranslations}(),c=new y(function(){var e=document.querySelector("form");if(!e)throw new TypeError("No form exists in this page.");return e}(),f,alert),h=new o(s),v=new j(k,".spinner",'<span class="spinner is-active"></span>'),p=new O,w=new l(p),d=function(){var e=document.querySelector(".mlp-attachment-schedule-notice");if(!e)throw new TypeError("Impossible to retrieve the schedule notice html element. Element does not exists");return e=new i(e)}(),g=new K(d,w),E=new u(e,h,d,g),x=new m(E,h,w,c,f),T=new b(e.ajax,x,c,s,n),M=t.attachmentDuplicatorActions,P=M.nonce,W=M.nonceAction,C=M.nameAjaxHook,z=new J(E,h);return{domDocument:s,scheduleNotice:E,scheduleStatusStorage:g,scheduleStatusFactory:w,scheduleStatusResponseHandler:x,scheduleStatusUpdater:T,eventDispatcher:h,form:c,translations:f,spinner:v,ajaxUrl:a,stopAttachmentDuplicationProcessClient:new L(e.ajax,a,new q(P,W),C,z,v)}}())}catch(e){console.warn(e.message)}else console.warn("No schedule data available, duplication notice will not work as expected.")}(jQuery,adminpage,window.siteDuplicatorScheduleData)}]);