var MultilingualPress=window.MultilingualPress||{},MultilingualPressRedirectorSettings=window.MultilingualPressRedirectorSettings||{};MultilingualPress.RedirectorSettings=MultilingualPressRedirectorSettings,delete window.MultilingualPressRedirectorSettings,function(r,t,u){"use strict";MultilingualPress.LanguageSearch=function(i){var t,n,a,o,e,s={};this.init=function(){return t=i.closest("td"),n=r(i.data("connected")),a=t.find(".current-selection"),o=t.find(".remove-selection"),e=i.data("none"),i.autocomplete({minLength:2,select:function(t,e){return a&&a.text(e.item.label),n&&n.val(e.item.value),o&&o.show(),r(this).val(""),!1},source:function(t,e){t.term in s?e(s[t.term]):function(e,n){r.ajax({url:u,method:"POST",dataType:"json",data:{action:i.data("action"),search:e}}).done(function(t){return t.success&&t.data&&r.isArray(t.data)?(s[e]=t.data,n(t.data)):[]}).fail(function(){return n([])})}(t.term,e)}}),o.click(function(t){t.preventDefault(),a.text(e),n.val(""),i.val(""),o.hide()}),this}}}(jQuery,0,ajaxurl),function(f,t,p){"use strict";MultilingualPress.NavMenu=function(a,e,o){function n(t){c.css("visibility",t?"visible":"hidden")}function i(){var t=[];return l.filter(":checked").each(function(){t.push(Number(f(this).val()||0))}),t}function s(){a.prop("disabled",!(e.length&&i().length))}function r(){alert("AJAX error.")}function u(t){n(!0),a.prop("disabled",!0),l.prop("disabled",!0),f.ajax({url:p,method:"POST",dataType:"json",data:function(t){var e=a.data("nonce-action"),n=a.data("nonce"),i={action:a.data("action"),mlp_sites:t,menu:o.val()};return i[e]=n,i}(t)}).done(function(t){t.success&&t.data&&"string"==typeof t.data?function(t){t.length?e.append(t):r()}(f(t.data)):r()}).fail(function(){r()}).always(function(){n(!1),l.prop("checked",!1),l.prop("disabled",!1),a.prop("disabled",!0)})}var l,t,c,d=!1;this.init=function(){return d||(l=f(a.data("languages")),t=f(a.data("select-all")),c=a.siblings(".spinner"),l.click(function(){s()}),t.click(function(t){t.preventDefault(),l.prop("checked",!0),s()}),a.click(function(){var t=i();t&&e.length&&u(t)}),s(),d=!0),this}}}(jQuery,0,ajaxurl),function(o){"use strict";MultilingualPress.NewSiteLanguage=function(t,a){function e(){var t,e,n,i=o(this).val();(t=function(t){var e=a.find('option[data-locale="'+t+'"]');return e.length?e.attr("value"):null}(i))?a.val(t):(e=function(t){var e=a.find('option[data-iso="'+t+'"]');return e.length?e.attr("value"):null}(i))?a.val(e):(n=function(t){for(var e,n=t.split("_");n.length;)if(n.pop(),(e=a.find('option[data-locale="'+n.join("_")+'"]')).length)return e.attr("value");return null}(i))&&a.val(n)}var n=!1;this.init=function(){return n||(t.change(e),n=!0),this}}}(jQuery),function(){"use strict";MultilingualPress.PostTranslationContext=function(t){var e=!1,n={};this.init=function(){return e||(n.source_site_id=t.data("source-site"),n.source_post_id=t.data("source-post"),n.remote_site_id=t.data("remote-site"),n.remote_post_id=t.data("remote-post"),n.post_type=t.data("post-type"),e=!0),this},this.sourceSiteId=function(){return Number(n.source_site_id||0)},this.sourcePostId=function(){return Number(n.source_post_id||0)},this.remoteSiteId=function(){return Number(n.remote_site_id||0)},this.remotePostId=function(){return Number(n.remote_post_id||0)},this.postType=function(){return String(n.post_type||"")}}}(jQuery),function(i){"use strict";MultilingualPress.PostTranslationTaxonomies=function(t,e){var n=!1;this.init=function(){return n||(n=!0,e.length&&t.change(function(){e.toggle(!i(this).is(":checked"))})),this}}}(jQuery),function(i){"use strict";MultilingualPress.SitesRelationshipBulkSelection=function(){function t(n){n.preventDefault(),n.stopImmediatePropagation();var t=i(".mlp-relationships-languages");t.length&&t.find('input[type="checkbox"]').each(function(t,e){e.checked="select"===i(n.currentTarget).data("action")})}var e=!1;this.init=function(){return e||(i(".mlp-site-bulk-relations").on("click",t),e=!0),this}}}(jQuery),function(){"use strict";MultilingualPress.TermTranslationContext=function(t){var e=!1,n={};this.init=function(){return e||(n.source_site_id=t.data("source-site"),n.source_term_id=t.data("source-term"),n.remote_site_id=t.data("remote-site"),n.remote_term_id=t.data("remote-term"),n.taxonomy=t.data("taxonomy"),e=!0),this},this.sourceSiteId=function(){return Number(n.source_site_id||0)},this.sourceTermId=function(){return Number(n.source_term_id||0)},this.remoteSiteId=function(){return Number(n.remote_site_id||0)},this.remoteTermId=function(){return Number(n.remote_term_id||0)},this.taxonomy=function(){return String(n.taxonomy||"")}}}(jQuery),function(t,d){"use strict";d.TranslationBoxFactory={createContext:function(t,e){return"term"===t?new d.TermTranslationContext(e):new d.PostTranslationContext(e)},create:function(t,e){var n=e.find(".tab-relation"),i=n.find(".search-input-row"),a=n.find(".update-relationship"),o=n.find(".main-row input"),s=d.TranslationBoxFactory.createContext(t,e),r=new d.TraslationBoxTabs(e),u=new d.TranslationSearch(t,s,i,a),l=new d.TranslationRelationshipUpdater(t,u,s,e),c=new d.TranslationRelationship(l,r,u,o,a);s.init(),r.init(),u.init(),c.init(),"post"===t&&new d.PostTranslationTaxonomies(e.find(".mlp-taxonomy-sync input"),e.find(".mlp-taxonomy-box")).init()}}}(jQuery,MultilingualPress),function(g,t,v){"use strict";MultilingualPress.TranslationRelationship=function(i,n,a,o,s){function r(){var t;return e||(t=n.findInPanel("relation","input, select, textarea"),e=n.findInAllPanels("input, select, textarea").not(t)),e}function u(){return o.filter(":checked").val()}function l(t){var e=t||u();if(a.hideResults(),"new"===e||"leave"===e)return r().attr("disabled",!1),n.enable(),s.hide().attr("disabled",!0),void a.showField(!1);"nothing"===e&&s.hide().attr("disabled",!0),a.showField("existing"===e),n.activate("relation"),n.disable(),r().attr("disabled",!0),"existing"!==e&&"remove"!==e||s.attr("disabled","existing"===e).show()}function c(t){(h=h||g('<span class="spinner" style="float: none; margin: 0 10px 5px;"></span>').appendTo(s.parent())).css("visibility",t?"visible":"hidden")}function d(t,e){o.attr("disabled",!0),s.attr("disabled",!0),a.hideResults(),a.showField(!1),c(!0)}function f(t,e){l(),o.attr("disabled",!1),c(!1)}function p(t,e,n){l(),o=n.find(".tab-relation").find(".main-row input"),c(!1)}function t(){if(void 0!==wp.data){var e=wp.data.select("core/edit-post");if(e instanceof Object){var n=!1;wp.data.subscribe(function(){if(-1===window.location.href.indexOf("&classic-editor")){var t=e.isSavingMetaBoxes();t===n||t||(n=t,i.updateRelation(u(),d,p,f)),n=t}})}}}var e,h,m=!1;this.init=function(){return m||(o.on("change",function(){l(g(this).val())}),s.on("click",function(t){t.preventDefault(),i.updateRelation(u(),d,p,f)}),-1!==["post-php","post-new-php"].indexOf(v)&&t(),l(),m=!0),this}}}(jQuery,0,adminpage),function(u,l,c){"use strict";l.TranslationRelationshipUpdater=function(s,n,i,r){function e(t){var e;return-1===["existing","remove","new"].indexOf(t)?null:"existing"!==t||(e=n.selectedResult())?function(t,e){var n={task:t,source_site_id:i.sourceSiteId(),remote_site_id:i.remoteSiteId()};return"term"===s?(e=e||i.remoteTermId(),n.source_term_id=i.sourceTermId(),n.remote_term_id=e,n.action="multilingualpress_update_term_relationship"):(e=e||i.remotePostId(),n.source_post_id=i.sourcePostId(),n.remote_post_id=e,n.action="multilingualpress_update_post_relationship"),n}(t,"existing"===t?e:null):null}this.updateRelation=function(n,t,i,a){var o=e(n);o&&(t(n,o),u.ajax({url:c,method:"POST",dataType:"json",data:o}).done(function(t){var e=function(t){var e,n;return t.success&&t.data&&"string"==typeof t.data&&(n=u(t.data)).length?((e=r.parent()).find(".mlp-warning").remove(),r.remove(),n.appendTo(e),l.TranslationBoxFactory.create(s,n),n):null}(t);e.length?i(n,o,e):a(n,o)}).fail(function(){a(n,o)}))}}}(jQuery,MultilingualPress,ajaxurl),function(b,t,_){"use strict";MultilingualPress.TranslationSearch=function(i,a,n,o){function e(t){var e=function(t){var e,n,i,a;return"object"==typeof t&&t?(e=t.id||0,n=t.title||"",e&&n?((a=(i=c.clone()).find("input")).val(e),a.attr("aria-label",n),i.find("span").text(n+" (ID: "+e+")"),i):null):null}(t);e&&(e.find("input").on("change",function(){var t=b(this);t.is(":checked")&&(o.attr("disabled",!1),e.closest("table").find("td").removeClass("selected"),t.closest("td").addClass("selected"))}),e.appendTo(l),m++)}function s(n){var t=g[i]||{};n in t?h.showResults(t[n]):(i in g||(g[i]={}),r.addClass("ui-autocomplete-loading"),b.ajax({url:_,method:"POST",dataType:"json",data:function(t,e){var n={action:r.data("action"),search:e,source_site_id:a.sourceSiteId(),remote_site_id:a.remoteSiteId()};return"term"===t?(n.source_term_id=a.sourceTermId(),n.remote_term_id=a.remoteTermId()):(n.source_post_id=a.sourcePostId(),n.remote_post_id=a.remotePostId()),n}(i,n)}).done(function(t){var e=!(!t.success||!t.data)&&t.data;e&&(g[i][n]=e),h.showResults(e)}).fail(function(){h.showResults(!1)}).always(function(){r.removeClass("ui-autocomplete-loading")}))}var r,u,l,c,d,f,p,h=this,m=0,g={};function v(t){if(13!==t.which){p&&clearTimeout(p);var e=r.val();e!==f&&(e.length<2?h.hideResults(!1):(f=e,p=setTimeout(function(){s(e),f=null},300)))}}this.init=function(){if(!r){(r=n.find("input")).val(""),r.keyup(v).keydown(function(t){13===t.which&&t.preventDefault()}),r.on("paste",function(t){return function(t){s(function(t){return t&&t.clipboardData&&"function"==typeof t.clipboardData.getData?t.clipboardData.getData("text"):""}(t))}(t.originalEvent)}),u=b(r.data("results"));var t=(l=u.find("table tbody")).find(".search-results-row"),e=l.find(".search-results-none");c=t.clone().show(),d=e.clone().show(),t.remove(),e.remove()}},this.showField=function(t){n.toggle(t)},this.showResults=function(t){!function(t){m=0,l.empty(),o.attr("disabled",!0),"object"==typeof t&&t&&t.map?(t.map(e),m<1&&d.clone().appendTo(l)):d.clone().appendTo(l)}(t),u.show()},this.hideResults=function(t){l.empty(),u.hide(),!1!==t&&r.val("")},this.selectedResult=function(){var t=l.find("input:checked").eq(0);return t.length?t.val():null}}}(jQuery,0,ajaxurl),function(o){"use strict";MultilingualPress.TraslationBoxTabs=function(i){var a,n;this.init=function(){return i.tabs({active:0,activate:function(t,e){e.newTab,e.newPanel,o(this).trigger("translation-metabox-tab-activated",e)},create:function(t,e){e.tab,e.panel,o(this).trigger("translation-metabox-tab-created",e)}}),this},this.disable=function(){this.init(),i.tabs("disable")},this.enable=function(){this.init(),i.tabs("enable")},this.activate=function(t){var e=0;this.init(),t&&(n=n||i.find(".nav-tab")).each(function(){o(this).attr("id").match(/tab-([a-z-]+)$/)[1]===t&&i.tabs("option","active",e),e++})},this.findInPanel=function(t,e){var n;return(n=(a=a||i.find(".wp-tab-panel")).find(".tab-"+t)).length?n.find(e):n},this.findInAllPanels=function(t){return(a=a||i.find(".wp-tab-panel")).find(t)}}}(jQuery),function(t,e,n){"use strict";t(function(){"post-new-php"!==n&&"post-php"!==n||t(".mlp-translation-metabox").each(function(){e.TranslationBoxFactory.create("post",t(this))}),"term-php"===n&&t(".mlp-translation-metabox").each(function(){e.TranslationBoxFactory.create("term",t(this))}),"site-new-php"===n&&new e.NewSiteLanguage(t("#site-language"),t("#mlp-site-language")).init(),"sites_page_multilingualpress-site-settings"===n&&new e.LanguageSearch(t("#mlp-site-language")).init(),"site-new-php"!==n&&"sites_page_multilingualpress-site-settings"!==n||(new e.SitesRelationshipBulkSelection).init(),"nav-menus-php"===n&&new e.NavMenu(t("#mlp-languages-submit"),t("#menu-to-edit"),t("#menu")).init()})}(jQuery,MultilingualPress,adminpage);